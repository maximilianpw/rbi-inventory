name: Close Stale Issues and PRs

on:
  schedule:
    # Run daily at 1:00 AM UTC
    - cron: '0 1 * * *'
  workflow_dispatch: # Allow manual triggering

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    name: Mark Stale Items
    runs-on: ubuntu-latest
    steps:
      - name: Mark stale issues and PRs
        uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}

          # Issues configuration
          days-before-issue-stale: 60
          days-before-issue-close: 14
          stale-issue-label: 'stale'
          stale-issue-message: |
            This issue has been automatically marked as stale because it has not had
            recent activity. It will be closed in 14 days if no further activity occurs.

            If this issue is still relevant, please:
            - Add a comment to keep it open
            - Remove the 'stale' label
            - Add more context or updates

            Thank you for your contributions!
          close-issue-message: |
            This issue was automatically closed due to inactivity.
            If you believe this issue is still relevant, please reopen it or create a new issue.

          # Pull requests configuration
          days-before-pr-stale: 30
          days-before-pr-close: 14
          stale-pr-label: 'stale'
          stale-pr-message: |
            This pull request has been automatically marked as stale because it has not had
            recent activity. It will be closed in 14 days if no further activity occurs.

            If you're still working on this PR, please:
            - Push new commits
            - Add a comment with an update
            - Remove the 'stale' label
            - Resolve any merge conflicts

            Thank you for your contribution!
          close-pr-message: |
            This pull request was automatically closed due to inactivity.
            If you'd like to continue this work, please reopen the PR or create a new one.

          # Exemptions
          exempt-issue-labels: 'pinned,security,blocked,in-progress'
          exempt-pr-labels: 'pinned,security,blocked,in-progress,wip'
          exempt-all-milestones: true

          # Behavior
          ascending: true
          operations-per-run: 50
